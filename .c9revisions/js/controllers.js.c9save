{"ts":1380739275130,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿'use strict';\r\n/* Controllers */\r\nangular.module('app.controllers', [])\r\n\t.controller('CommoditiesCtrl',['$scope', '$q', '$filter', 'MarketService', 'CountryInfoService', \r\n\t\tfunction($scope, $q, $filter, MarketService,CountryInfoService){\r\n\t\t\t$scope.countryInfoService = CountryInfoService;\r\n\t\t\t$scope.sortingOrder  = 'name';\r\n\t\t\t$scope.pagedItems = [];\r\n\t\t\t$scope.currentPage = 0;\r\n\t\t\t$scope.filteredItems = [];\r\n\t\t\t$scope.itemsPerPage = 10;\r\n\t\t\t$scope.reverse = false;\t\t\t\r\n\t\t\t$scope.items = $scope.commodities;\t\t\t\r\n\t\t\t$scope.filteredItems=$scope.items;\t\r\n\t\t\t\r\n\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t}\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\tvar searchMatch = function (haystack, needle) {\t\t\t\t\r\n\t\t\t\tif (!needle) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\thaystack = haystack+\"\";\r\n\t\t\t\treturn haystack.toLowerCase().indexOf(needle.toLowerCase()) !== -1;\r\n\t\t\t};\r\n\r\n\t\t\t$scope.search = function(){\r\n\t\t\t\t$scope.filteredItems = $filter('filter')($scope.items, function (item) {\r\n\t\t\t\t\tfor (var attr in item) {\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (searchMatch(item[attr], $scope.query)) return true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.currentPage = 0;\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.sort_by = function (newSortingOrder) {\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder == newSortingOrder) {\r\n\t\t\t\t\t$scope.reverse = !$scope.reverse;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.sortingOrder = newSortingOrder;\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.groupToPages = function () {\r\n\t\t\t\t$scope.pagedItems = [];\t\t\t\t\r\n\t\t\t\tfor (var i = 0; i < $scope.filteredItems.length; i++) {\r\n\t\t\t\t\tif (i % $scope.itemsPerPage === 0) {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)] = [$scope.filteredItems[i]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)].push($scope.filteredItems[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.range = function (start, end) {\r\n\t\t\t\tvar ret = [];\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tend = start;\r\n\t\t\t\t\tstart = 0;\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = start; i < end; i++) {\r\n\t\t\t\t\tret.push(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t\t\t\r\n\t\t\t$scope.prevPage = function () {\r\n\t\t\t\tif ($scope.currentPage > 0) {\r\n\t\t\t\t\t$scope.currentPage--;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.nextPage = function () {\r\n\t\t\t\tif ($scope.currentPage < $scope.pagedItems.length - 1) {\r\n\t\t\t\t\t$scope.currentPage++;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.setPage = function () {\r\n\t\t\t\t$scope.currentPage = this.n;\r\n\t\t\t};\r\n\t\t\t\r\n\t}])\t\r\n\t.controller('IndexCtrl',['$scope', '$q', '$filter', 'MarketService', 'CountryInfoService', \r\n\t\tfunction($scope, $q, $filter, MarketService,CountryInfoService){\r\n\t\t\t$scope.countryInfoService = CountryInfoService;\r\n\t\t\t$scope.sortingOrder  = 'name';\r\n\t\t\t$scope.pagedItems = [];\r\n\t\t\t$scope.currentPage = 0;\r\n\t\t\t$scope.filteredItems = [];\r\n\t\t\t$scope.itemsPerPage = 10;\r\n\t\t\t$scope.reverse = false;\r\n\t\t\t$scope.items = [];\r\n\t\t\tMarketService.async('MarketIndexes').then(function(data){ \t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tangular.forEach(data,function(item){\t\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\tvar chg = (item[\"% Change\"] || \"0\").replace(\"%\",\"\").replace(\"+\",\"\") * 1;\r\n\t\t\t\t\tvar boxPlotArray =[];\t\t\t\t\t\t\r\n\t\t\t\t\tif( \r\n\t\t\t\t\t\titem[\"Day Range\"]\r\n\t\t\t\t\t\t&& item[\"Day Range\"].split(' - ').length > 1 \r\n\t\t\t\t\t\t&& item[\"52 Week Range\"] \r\n\t\t\t\t\t\t&& item[\"52 Week Range\"].split(' - ').length > 1  \t\t\t\t\t\t\t\r\n\t\t\t\t\t\t) {\t\t\t\t\t\r\n\t\t\t\t\t\tboxPlotArray = [\r\n\t\t\t\t\t\t\tNumber(item[\"52 Week Range\"].split(' - ')[0].replace(/[^0-9\\.]+/g,\"\")),\r\n\t\t\t\t\t\t\tNumber(item[\"Day Range\"].split(' - ')[0].replace(/[^0-9\\.]+/g,\"\")),\r\n\t\t\t\t\t\t\tNumber(item[\"Value\"].replace(',','').replace(/[^0-9\\.]+/g,\"\")),\r\n\t\t\t\t\t\t\tNumber(item[\"Day Range\"].split(' - ')[1].replace(/[^0-9\\.]+/g,\"\")),\r\n\t\t\t\t\t\t\tNumber(item[\"52 Week Range\"].split(' - ')[1].replace(/[^0-9\\.]+/g,\"\"))\r\n\t\t\t\t\t\t\t];\t\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$scope.items.push({\r\n\t\t\t\t\t\tname: item[\"Index Name\"].replace(\"Index\",\"\").replace(\"Stock Exchange\",\"\").split(\"(\")[0],\r\n\t\t\t\t\t\tabsChange: Math.abs(chg),\r\n\t\t\t\t\t\tdate: item[\"Date/Time\"],\r\n\t\t\t\t\t\tchange: item[\"% Change\"] ,\r\n\t\t\t\t\t\tdayRange: item[\"Day Range\"],\r\n\t\t\t\t\t\toneYearChange: item[\"One Year\"],\r\n\t\t\t\t\t\tabsOneYearChange: Math.abs((item[\"One Year\"] || \"0\").replace(\"%\",\"\").replace(\"+\",\"\") * 1),\r\n\t\t\t\t\t\tfiftyTwoWeekRange:item[\"52 Week Range\"],\r\n\t\t\t\t\t\tyearToDateChange: item[\"Year To Date\"],\r\n\t\t\t\t\t\tboxPlotData: boxPlotArray,\r\n\t\t\t\t\t\tvalue: item[\"Value\"],\r\n\t\t\t\t\t\ttimeStamp: item[\"DateGathered\"]\r\n\t\t\t\t\t})\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems=$scope.items;\t\t\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvar searchMatch = function (haystack, needle) {\t\t\t\t\r\n\t\t\t\tif (!needle) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\thaystack = haystack+\"\";\r\n\t\t\t\treturn haystack.toLowerCase().indexOf(needle.toLowerCase()) !== -1;\r\n\t\t\t};\r\n\r\n\t\t\t$scope.search = function(){\r\n\t\t\t\t$scope.filteredItems = $filter('filter')($scope.items, function (item) {\r\n\t\t\t\t\tfor (var attr in item) {\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (searchMatch(item[attr], $scope.query)) return true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.currentPage = 0;\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.sort_by = function (newSortingOrder) {\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder == newSortingOrder) {\r\n\t\t\t\t\t$scope.reverse = !$scope.reverse;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.sortingOrder = newSortingOrder;\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.groupToPages = function () {\r\n\t\t\t\t$scope.pagedItems = [];\t\t\t\t\r\n\t\t\t\tfor (var i = 0; i < $scope.filteredItems.length; i++) {\r\n\t\t\t\t\tif (i % $scope.itemsPerPage === 0) {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)] = [$scope.filteredItems[i]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)].push($scope.filteredItems[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.range = function (start, end) {\r\n\t\t\t\tvar ret = [];\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tend = start;\r\n\t\t\t\t\tstart = 0;\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = start; i < end; i++) {\r\n\t\t\t\t\tret.push(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t\t\t\r\n\t\t\t$scope.prevPage = function () {\r\n\t\t\t\tif ($scope.currentPage > 0) {\r\n\t\t\t\t\t$scope.currentPage--;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.nextPage = function () {\r\n\t\t\t\tif ($scope.currentPage < $scope.pagedItems.length - 1) {\r\n\t\t\t\t\t$scope.currentPage++;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.setPage = function () {\r\n\t\t\t\t$scope.currentPage = this.n;\r\n\t\t\t};\r\n\t\t\t\r\n\t}])\r\n\t.controller('IndicatorsCtrl', ['$scope', '$q', '$filter', 'MarketService', 'CountryInfoService', \r\n\t\tfunction($scope, $q, $filter, MarketService,CountryInfoService){\r\n\t\t\t$scope.countryInfoService = CountryInfoService;\r\n\t\t\t$scope.sortingOrder  = 'name';\r\n\t\t\t$scope.pagedItems = [];\r\n\t\t\t$scope.currentPage = 0;\r\n\t\t\t$scope.filteredItems = [];\r\n\t\t\t$scope.itemsPerPage = 10;\r\n\t\t\t$scope.reverse = false;\r\n\t\t\t$scope.items = [];\r\n\t\t\tMarketService.async('Indicators').then(function(data){ \t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tangular.forEach(data,function(item){\t\t\t\t\t\t\t\r\n\t\t\t\t\tvar mc = undefined;\r\n\t\t\t\t\tvar mcr = undefined;\t\t\t\t\t\t\r\n\r\n\t\t\t\t\tif( item['ActNum'] && item['ConsNum'] ){\r\n\t\t\t\t\t\tmc = item['ConsNum'] != item['ActNum'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( item['ActNum'] && item['ConsRangeMin'] ){\r\n\t\t\t\t\t\tmcr = item['ConsRangeMin']  > item['ActNum'] && item['ConsRangeMax']  < item['ActNum'] ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tvar releasedDate =moment( item[\"Dated\"].replace('Released On','').split('For')[0],\"M/D/YYYY h:mm:ss a\" )\r\n\t\t\t\t\tvar releasedFor = item[\"Dated\"].replace('Released On','').split('For')[1];\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t$scope.items.push({\r\n\t\t\t\t\t\t\tname: item['Indicator'],\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tcountry: item['Country'],\r\n\t\t\t\t\t\t\tmeasure: item['Measure'],\r\n\t\t\t\t\t\t\tdated: item['Dated'],\r\n\t\t\t\t\t\t\tactual: item['Actual'],\r\n\t\t\t\t\t\t\tprior: item['Prior'],\r\n\t\t\t\t\t\t\tpriorRev: item['Prior Revised'],\r\n\t\t\t\t\t\t\tconsensus: item['Consensus'],\r\n\t\t\t\t\t\t\tconsensusRange: item['Consensus Range'],\r\n\t\t\t\t\t\t\tactualNum: item['ActNum'],\r\n\t\t\t\t\t\t\tconsensusNum: item['ConsNum'],\r\n\t\t\t\t\t\t\tconsensusRangeMin: item['ConsRangeMin'],\r\n\t\t\t\t\t\t\tconsensusRangeMax: item['ConsRangeMax'],\r\n\t\t\t\t\t\t\tpriorNum: item['PriNum'],\r\n\t\t\t\t\t\t\tpriorRevisedNum: item['PriRevNum'],\r\n\t\t\t\t\t\t\ttimeStamp: item['DateParsed'],\r\n\t\t\t\t\t\t\tmissedConsensusRange: mcr,\r\n\t\t\t\t\t\t\tmissedConsensus: mc,\r\n\t\t\t\t\t\t\treleasedOnDate: releasedDate,\r\n\t\t\t\t\t\t\treleasedForPeriod: releasedFor\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t});\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems=$scope.items;\t\t\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvar searchMatch = function (haystack, needle) {\t\t\t\t\r\n\t\t\t\tif (!needle) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\thaystack = haystack+\"\";\r\n\t\t\t\treturn haystack.toLowerCase().indexOf(needle.toLowerCase()) !== -1;\r\n\t\t\t};\r\n\r\n\t\t\t$scope.search = function(){\r\n\t\t\t\t$scope.filteredItems = $filter('filter')($scope.items, function (item) {\r\n\t\t\t\t\tfor (var attr in item) {\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (searchMatch(item[attr], $scope.query)) return true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.currentPage = 0;\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.sort_by = function (newSortingOrder) {\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder == newSortingOrder) {\r\n\t\t\t\t\t$scope.reverse = !$scope.reverse;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.sortingOrder = newSortingOrder;\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.groupToPages = function () {\r\n\t\t\t\t$scope.pagedItems = [];\t\t\t\t\r\n\t\t\t\tfor (var i = 0; i < $scope.filteredItems.length; i++) {\r\n\t\t\t\t\tif (i % $scope.itemsPerPage === 0) {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)] = [$scope.filteredItems[i]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)].push($scope.filteredItems[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.range = function (start, end) {\r\n\t\t\t\tvar ret = [];\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tend = start;\r\n\t\t\t\t\tstart = 0;\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = start; i < end; i++) {\r\n\t\t\t\t\tret.push(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t\t\t\r\n\t\t\t$scope.prevPage = function () {\r\n\t\t\t\tif ($scope.currentPage > 0) {\r\n\t\t\t\t\t$scope.currentPage--;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.nextPage = function () {\r\n\t\t\t\tif ($scope.currentPage < $scope.pagedItems.length - 1) {\r\n\t\t\t\t\t$scope.currentPage++;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.setPage = function () {\r\n\t\t\t\t$scope.currentPage = this.n;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.$watch('countryInfoService.selectedCountries',function(){\r\n\t\t\t\tvar result = true;\r\n\t\t\t\t\r\n\t\t\t\tif($scope.countryInfoService.selectedCountries.length > 0){\r\n\t\t\t\t\t$scope.filteredItems = $filter('filter')($scope.filteredItems, function(item){\r\n\t\t\t\t\t\tvar itemCountry = item.country.toLowerCase();\t\t\t\t\r\n\t\t\t\t\t\tfor(var i=0;i < $scope.countryInfoService.selectedCountries.length; i++){\r\n\t\t\t\t\t\t\tif($scope.countryInfoService.selectedCountries[i].CountryName.toLowerCase().trim()===itemCountry.trim()) {\r\n\t\t\t\t\t\t\t\treturn  true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else { \r\n\t\t\t\t\t$scope.filteredItems=$scope.items;\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\r\n\t}])\r\n\t.controller('CurrenciesCtrl', ['$scope', '$q', '$filter', 'MarketService',  'CountryInfoService',\r\n\t\tfunction($scope, $q, $filter, MarketService, CountryInfoService){\r\n\t\t\t$scope.countryInfoService = CountryInfoService;\r\n\t\t\t$scope.sortingOrder  = 'name';\r\n\t\t\t$scope.pagedItems = [];\r\n\t\t\t$scope.currentPage = 0;\r\n\t\t\t$scope.filteredItems = [];\r\n\t\t\t$scope.itemsPerPage = 10;\r\n\t\t\t$scope.reverse = false;\r\n\t\t\t$scope.items = [];\r\n\t\t\tMarketService.async('Currencies').then(function(data){ \r\n\t\t\t\t\r\n\t\t\t\tangular.forEach(data,function(item){\t\t\t\t\t\t\t\r\n\t\t\t\t\tvar chg =  (item[\"% Change\"] || \"0\").replace(\"%\",\"\").replace(\"+\",\"\") * 1;\r\n\t\t\t\t\tvar currencies = item['Name'].match(/\\(\\w+\\)/g);\r\n\t\t\t\t\tvar name = item['Name'].replace('Exchange Rate','');\r\n\t\t\t\t\tvar currency = name.indexOf('to US DOLLAR (USD)') > 0 ? \"USD\": \"\";\r\n\t\t\t\t\tname = name.replace('to US DOLLAR (USD)','USD').replace('US DOLLAR (USD) to','');\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\tvar boxPlotArray =[];\r\n\t\t\t\t\tboxPlotArray = [\r\n\t\t\t\t\t\tNumber(item[\"52-WK Low\"].replace(/[^0-9\\.]+/g,\"\")),\r\n\t\t\t\t\t\tNumber(item[\"Value\"].replace(/[^0-9\\.]+/g,\"\")),\r\n\t\t\t\t\t\tNumber(item[\"52-WK High\"].replace(/[^0-9\\.]+/g,\"\"))\r\n\t\t\t\t\t];\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t$scope.items.push({\r\n\t\t\t\t\t\tname: name,\r\n\t\t\t\t\t\tchange:chg,\r\n\t\t\t\t\t\tcurrency: currencies,\r\n\t\t\t\t\t\tcurrentValue: item.Value,\r\n\t\t\t\t\t\tboxPlotData: boxPlotArray,\r\n\t\t\t\t\t\tabsChange:Math.abs(chg),\r\n\t\t\t\t\t\ttimeStamp:item['DateGathered']\r\n\t\t\t\t\t});\r\n\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems=$scope.items;\t\t\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t$scope.$watch('countryInfoService.selectedCountries',function(){\r\n\t\t\t\tvar result = true;\r\n\t\t\t\t$scope.filteredItems = $scope.items;\r\n\t\t\t\tif($scope.countryInfoService.selectedCountries.length > 0){\r\n\t\t\t\t\t$scope.filteredItems = $filter('filter')($scope.filteredItems, function(item){\r\n\t\t\t\t\t\tvar itemCurrencyCode = item.currency[1].replace(/\\(|\\)/g,'').toLowerCase();\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor(var i=0;i < $scope.countryInfoService.selectedCountries.length; i++){\r\n\t\t\t\t\t\t\tvar currencyToCompare  = $scope.countryInfoService.selectedCountries[i].CurrencyCode.toLowerCase().trim();\r\n\t\t\t\t\t\t\tvar firstItemCurrency = item.currency[0].replace(/\\(|\\)/g,'').toLowerCase().trim();\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar secondItemCurrency = item.currency[1].replace(/\\(|\\)/g,'').toLowerCase().trim();\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif(currencyToCompare === firstItemCurrency || currencyToCompare === secondItemCurrency ) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn  true;\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else { \r\n\t\t\t\t\t$scope.filteredItems=$scope.items;\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvar searchMatch = function (haystack, needle) {\t\t\t\t\r\n\t\t\t\tif (!needle) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\thaystack = haystack+\"\";\r\n\t\t\t\treturn haystack.toLowerCase().indexOf(needle.toLowerCase()) !== -1;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.search = function(){\r\n\t\t\t\t$scope.filteredItems = $filter('filter')($scope.items, function (item) {\r\n\t\t\t\t\tfor (var attr in item) {\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (searchMatch(item[attr], $scope.query)) return true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder !== '') {\r\n\t\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.currentPage = 0;\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.sort_by = function (newSortingOrder) {\r\n\t\t\t\t\r\n\t\t\t\tif ($scope.sortingOrder == newSortingOrder) {\r\n\t\t\t\t\t$scope.reverse = !$scope.reverse;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$scope.sortingOrder = newSortingOrder;\r\n\t\t\t\t\r\n\t\t\t\t$scope.filteredItems = $filter('orderBy')($scope.filteredItems, $scope.sortingOrder, $scope.reverse);\r\n\t\t\t\t\r\n\t\t\t\t$scope.groupToPages();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.groupToPages = function () {\r\n\t\t\t\t$scope.pagedItems = [];\t\t\t\t\r\n\t\t\t\tfor (var i = 0; i < $scope.filteredItems.length; i++) {\r\n\t\t\t\t\tif (i % $scope.itemsPerPage === 0) {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)] = [$scope.filteredItems[i]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$scope.pagedItems[Math.floor(i / $scope.itemsPerPage)].push($scope.filteredItems[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.range = function (start, end) {\r\n\t\t\t\tvar ret = [];\r\n\t\t\t\tif (!end) {\r\n\t\t\t\t\tend = start;\r\n\t\t\t\t\tstart = 0;\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = start; i < end; i++) {\r\n\t\t\t\t\tret.push(i);\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t\t\t\r\n\t\t\t$scope.prevPage = function () {\r\n\t\t\t\tif ($scope.currentPage > 0) {\r\n\t\t\t\t\t$scope.currentPage--;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.nextPage = function () {\r\n\t\t\t\tif ($scope.currentPage < $scope.pagedItems.length - 1) {\r\n\t\t\t\t\t$scope.currentPage++;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$scope.setPage = function () {\r\n\t\t\t\t$scope.currentPage = this.n;\r\n\t\t\t};\r\n\t\t\t\r\n\t}])\r\n\t.controller('MarketsCtrl', [\r\n\t\t'$scope', '$q', '$filter',  'MarketService','CountryInfoService',\r\n\t\tfunction ($scope, $q, $filter,  MarketService, CountryInfoService) {        \t\t\t\t\t\t\t \t\t\t \t\t \t\t\t\t\t\t\r\n\t\t\r\n\t\t\t$scope.change=function(a,b){\r\n\t\t\t\ta = a.replace(',','');\r\n\t\t\t\tb = b.replace(',','');\r\n\t\t\t\treturn (b-a) / a;\t\t\t\t\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t$scope.countryInfoService = CountryInfoService;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tMarketService.async('Commodities').then(function(data){ \r\n\t\t\t\t\tvar metalsData = [];\r\n\t\t\t\t\tangular.forEach(data[3].items,function(item){\r\n\t\t\t\t\t\tvar chg = ($scope.change(item.PrevClose,item.Price)*100).toFixed(2);\t\t\t\t\t\t\r\n\t\t\t\t\t\tmetalsData.push({\r\n\t\t\t\t\t\t\tname: item.Name.split('-')[0],\r\n\t\t\t\t\t\t\tcurrent: item['Price'].replace(',',''),\r\n\t\t\t\t\t\t\tcurrencySymbol: $scope.currencySymbol[ item.Name.split('-')[1].replace(' Exchange Rate','') ],\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tchange: chg + ' %',\r\n\t\t\t\t\t\t\tabsChange: Math.abs(chg)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t$scope.metals = metalsData;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar commoditiesData = []\r\n\t\t\t\t\tangular.forEach(data[0].items,function(item){\t\t\t\t\r\n\t\t\t\t\t\tvar chg = item['Change %'].replace(\"%\",\"\").replace(\"+\",\"\") * 1;\r\n\t\t\t\t\t\tcommoditiesData.push({\r\n\t\t\t\t\t\t\tname:item.Name,\r\n\t\t\t\t\t\t\tprice:item.Price,\r\n\t\t\t\t\t\t\tdate: item.Date,\r\n\t\t\t\t\t\t\tunit: item.Unit,\r\n\t\t\t\t\t\t\tchange:chg,\r\n\t\t\t\t\t\t\ttimeStamp: item.DateGathered,\r\n\t\t\t\t\t\t\tabsChange: Math.abs(chg)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t$scope.commodities = commoditiesData;\r\n\t\t\t\t\t\r\n\t\t\t\t\t$scope.consumerRates = data[1].items;\r\n\t\t\t\t\t$scope.fedRates = data[2].items;\r\n\t\t\t\t\t$scope.muniRates = data[4].items;\r\n\t\t\t\t\t$scope.treasuryYields = data[8].items;\r\n\t\t\t\t\t$scope.usBondIndexes = data[7].items;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar gasolinePriceData  = [];\r\n\t\t\t\t\tangular.forEach(data[6].items,function(item){\r\n\t\t\t\t\t\tgasolinePriceData.push({\r\n\t\t\t\t\t\t\tregion:item['Name'].split('(')[0],\r\n\t\t\t\t\t\t\tcurrent:item['Current'],\r\n\t\t\t\t\t\t\tlastWeek:item['Change From Last Week'],\r\n\t\t\t\t\t\t\tlastYear:item['Change From Last Year'],\r\n\t\t\t\t\t\t\ttimeStamp: item['DateGathered']\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t$scope.gasolinePrices = gasolinePriceData;\r\n\t\t\t\t\t\t\r\n\t\t\t\t}),\t\t\r\n\t\t\t\r\n\t\t\t$scope.currencySymbol = {\t\t\t\r\n\t\t\t\t\t\t\"USD\": \"$\",\r\n\t\t\t\t\t\t\"USd\": \"$\",\r\n\t\t\t\t\t\t\"US DOLLAR\": \"$\",\r\n\t\t\t\t\t\t\"CAD\": \"CA $\",\r\n\t\t\t\t\t\t\"JPY\": \"¥\",\r\n\t\t\t\t\t\t\"JAPANESE YEN\": \"¥\",\r\n\t\t\t\t\t\t\"GBP\": \"£\",\r\n\t\t\t\t\t\t\"BRITISH POUND\": \"£\",\r\n\t\t\t\t\t\t\"EUR\": \"€\",\r\n\t\t\t\t\t\t\"EURO\": \"€\",\r\n\t\t\t\t\t\t\"INR\":\"₨\",\r\n\t\t\t\t\t\t\"INDIAN RUPEE\":\"Rs\"\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t}]);"]],"start1":0,"start2":0,"length1":0,"length2":19046}]],"length":19046}
{"contributors":[],"silentsave":false,"ts":1380739353214,"patch":[[{"diffs":[[-1,"﻿"],[0,"'use"]],"start1":0,"start2":0,"length1":5,"length2":4},{"diffs":[[0,", MarketService,"],[1," "],[0,"CountryInfoServi"]],"start1":203,"start2":203,"length1":32,"length2":33}]],"length":19046,"saved":false}
